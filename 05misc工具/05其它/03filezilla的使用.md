## 设置 SFTP 文件交换服务器与客户端实践

为了安全高效地进行文件交换和上传下载，我们将设置一个基于 SSH 密钥认证的 SFTP 服务器。

### 一、服务器端设置：创建用户与密钥对

我们使用 SSH 登录到服务器（例如阿里云），并进行用户设置和密钥生成。

1.  **切换到 Root 用户：**

    ```bash
    sudo su -
    ```

2.  **创建新用户（例如 user\_sftp）：**

    ```bash
    adduser user_sftp
    ```

3.  **设置用户密码：**

    ```bash
    passwd user_sftp
    # 输入并确认新密码
    ```

4.  **生成 SSH 密钥对（重要步骤）：**

      * 切换到新用户：
        ```bash
        su - user_sftp
        ```
      * 生成密钥对：
        ```bash
        ssh-keygen
        # 接受默认路径和空密码（实验环境）
        ```
      * 这一步会在用户主目录下生成 `.ssh/id_rsa`（私钥）和 `.ssh/id_rsa.pub`（公钥）。

5.  **部署公钥（安装“锁”）：**

      * 将公钥内容追加到授权文件（`authorized_keys`）中，即完成了“安装锁”的步骤，允许使用对应的私钥登录。
        ```bash
        cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
        # 确保权限设置正确
        chmod 700 ~/.ssh
        chmod 600 ~/.ssh/authorized_keys
        ```

6.  **打包密钥文件以便下载（用于客户端）：**

      * 将整个 `.ssh` 目录压缩打包：
        ```bash
        tar -czvf user_sftp_ssh_keys.tar.gz .ssh
        ```
      * 将压缩包移动到易于下载的目录（例如，Root 用户的主目录，或 Web 服务的根目录），以便通过 SFTP 或其他方式下载到本地客户端。
        ```bash
        mv user_sftp_ssh_keys.tar.gz /home/user_sftp/
        ```

7.  **下载密钥包：**

      * 使用 MobaXterm 或其他 SFTP 工具，将 `user_sftp_ssh_keys.tar.gz` 文件从服务器下载到本地计算机。

-----

### 二、客户端设置：FileZilla 与密钥认证登录

我们将使用专业的 SFTP 客户端 **FileZilla** 进行连接，并配置密钥认证。

#### 1\. FileZilla 的下载与运行

  * **下载：** 访问 FileZilla 官方网站，下载 **FileZilla Client** 的 Windows 64 位版本（推荐下载 ZIP 压缩包，解压即可运行）。
  * **运行：** 解压后，双击 `filezilla.exe` 运行程序。

#### 2\. 解压私钥文件

  * 使用 7-Zip 等工具，解压刚才下载到本地的 `user_sftp_ssh_keys.tar.gz`。
  * 在解压后的目录中找到 **私钥文件**（例如 `id_rsa`）。

#### 3\. 配置 FileZilla 站点管理器

1.  **打开站点管理器：** 点击左上角的“站点管理器”图标。
2.  **新建站点：** 点击“新建站点”，并命名。
3.  **配置协议：**
      * **协议（Protocol）：** 选择 **SFTP - SSH File Transfer Protocol**。
4.  **配置主机信息：**
      * **主机（Host）：** 输入服务器的公网 IP 地址。
      * **端口（Port）：** 默认为 22（如果服务器有更改，则输入对应端口）。
5.  **配置密钥登录：**
      * **登录类型：** 选择 **密钥文件（Key file）**。
      * **用户（User）：** 输入刚才创建的用户名（例如 `user_sftp`）。
      * **密钥文件（Key file）：** 点击“浏览”，找到并选择您刚才解压出来的 **私钥文件（`id_rsa`）**。
6.  **连接：** 点击“连接”，如果一切设置正确，客户端将成功连接到服务器。首次连接会提示信任主机密钥，点击“确定”。

### 三、文件交换与管理实践

连接成功后，您可以在 FileZilla 界面进行文件操作：

  * **上传：** 在本地窗口中选中文件，右键点击“上传”。
  * **下载：** 在远程服务器窗口中选中文件，右键点击“下载”。
  * **创建目录：** 在服务器窗口中右键，创建新的文件夹（例如 `课程`、`成品`、`中间文件`、`素材`）。

> **重要提醒：** 使用 SFTP 删除文件是 **直接删除**，没有回收站，操作时务必谨慎。

#### SSH 密钥认证原理小结

SSH 密钥认证是基于**非对称加密**的：

1.  **公钥（Public Key）** 就像一把锁（**服务器端**拥有）。我们把公钥部署到服务器的 `~/.ssh/authorized_keys` 文件中。
2.  **私钥（Private Key）** 就像一把钥匙（**客户端**拥有）。我们用私钥去尝试登录。
3.  服务器用锁（公钥）来验证钥匙（私钥）是否匹配。如果匹配，则允许免密码登录。

#### 隐藏文件设置（可选）

在 FileZilla 中，Linux 系统中以点（`.`）开头的文件是隐藏文件（例如 `.ssh` 目录）。

  * 你可以通过设置 FileZilla 的 **列表过滤器**，将其启用，以隐藏这些系统配置或隐藏文件，让界面只显示你需要的业务文件，使操作更加清爽。

至此，我们就完成了文件交换服务器的设置，能够通过安全的 SSH 密钥认证方式，进行文件的安全管理和传输。