## **第 2 集：程序与环境的桥梁——环境变量**

### **一、为什么要用环境变量？(Why)**

“在上一集，我们学会了用命令行启动程序。现在我们来思考一个更深层次的问题：**程序是如何知道自己该做什么的？**”

“如果你写了一个光伏模型计算程序，这个程序需要知道：**数据库的地址是什么？** **日志文件该存到哪里？** 最笨的方法是把地址写死在代码里。”

“**痛点：** 每次环境变动（比如数据库从测试机迁移到生产机），你都得**修改代码、重新编译、重新部署**。这在工程上是不可接受的。”

“**我们的目标：** 我们需要一个机制，允许我们在**不碰代码**的情况下，改变程序的行为。这个机制，就是工程界实现**配置与代码分离**的核心工具：**环境变量**。”

-----

### **二、环境变量是什么？(What)**

“环境变量本质上是操作系统为每一个程序维护的**一组键值对（Name-Value Pairs）**，它们定义了程序运行时的**环境（Environment）**。”

#### **核心概念：命名、值与环境**

“让我们从最基础的逻辑开始：”

1.  **命名（Name）：** 像 **`PATH`**、**`DATABASE_URL`** 都是名称。
2.  **值（Value）：** 只有给这个名称**赋值**（比如 `DATABASE_URL=mysql://...`），它才有了意义。
3.  **环境：** 操作系统维护着这种**名称-值对偶的关联存储**，这就是环境。当程序启动时，操作系统会将这个**环境集合**传递给程序。程序读取这些值，并根据它们来运行。

#### **环境变量的核心作用**

  * **配置与解耦：** 允许程序从环境中读取配置（如密钥、地址），实现**代码与配置的分离**。
  * **路径搜索（PATH）：** **PATH** 是最重要的环境变量。当你输入一个外部命令（如 `python` 或 `msedge`）时，系统不会在全盘搜索，它只会去 **PATH** 变量里记录的那些目录中查找对应的可执行文件。

#### **工程中常用的环境变量示例**

| 变量名 | 典型应用场景 | 作用 |
| :--- | :--- | :--- |
| **PATH** | 通用系统 | **系统查找可执行文件的目录列表。** |
| **DATABASE\_URL** | 后端服务 | 存储完整的数据库连接字符串（地址、密码等）。 |
| **LOG\_LEVEL** | 日志系统 | 控制程序输出日志的级别（如 DEBUG、INFO、ERROR）。 |
| **API\_KEY** | 第三方服务集成 | 存储访问外部服务所需的密钥。 |

-----

### **三、环境变量怎么做？(How)**

“环境变量的设置方法，取决于你想让它**临时生效**，还是**永久生效**，以及你使用的是 **Windows** 还是 **Linux**。”

#### **A. Windows 下设置（图形界面与命令行）**

**1. 永久设置（对所有新程序生效）：**

  * **步骤：** 右键点击 **“此电脑”** → **“属性”** → **“高级系统设置”** → **“环境变量”**。
  * **区分：** 你会看到**用户变量**（只对当前用户生效）和**系统变量**（对所有用户生效）。
  * **PATH 的特殊性：** Windows 下，`PATH` 变量的值是用\*\*分号（`;`）\*\*分隔的多个目录路径。

**2. 临时设置（仅对当前命令行会话生效）：**

在 CMD 或 PowerShell 中使用 `set` 命令：

```powershell
set LOG_LEVEL=DEBUG
```

**3. 永久设置（通过命令行）：**

使用 `setx` 命令，它等同于图形界面设置，但**效果需要在新开的命令行窗口中才能看到**：

```powershell
setx ENERGY_API_KEY "your_secure_key"
```

#### **B. Linux 下设置（Shell 配置文件）**

**1. 临时设置（仅对当前 Shell 会话生效）：**

使用 `export` 命令，这是 Linux 下最常见的方式：

```bash
export DATABASE_URL="mysql://user:pass@host:port/db"
echo $DATABASE_URL # 打印变量值
```

**2. 永久设置（对所有新会话生效）：**

你需要编辑你的 **Shell 配置文件**（通常是 **`~/.bashrc`** 或 **`~/.zshrc`**），将 `export` 语句写入其中：

  * **写入内容：** `export PORT=8080`
  * **立即生效：** 写入保存后，运行 `source ~/.bashrc` 使其立即生效，或者重新打开一个终端。
  * **PATH 的特殊性：** Linux 下，`PATH` 变量的值是用\*\*冒号（`:`）\*\*分隔的多个目录路径。

#### **C. 编译与链接时的环境变量**

“在工程编译时，还有一些用于构建环境的变量：”

  * **`INCLUDE_PATH`：** 告诉编译器，去哪里查找那些被**包含的头文件**（用于 C/C++ 等编译型语言）。
  * **`LD_LIBRARY_PATH`：** 告诉系统，去哪里查找程序运行时需要的**共享链接库**（`.so` 文件）。

-----

### **四、环境变量有何用？(So What)**

“环境变量是我们打造掘金铲，实现**高可用和安全部署**的关键。”

1.  **解耦配置（零改动部署）：** 在我们的 Go 工程中，我们会大量使用环境变量来配置数据库连接、API 密钥等。这样，我们就能做到**一套代码，适应所有环境**（开发、测试、生产）。
2.  **安全隔离：** 将像 **API Key** 这样的敏感信息存放在环境变量中，而不是硬编码到代码里，可以**防止密钥意外泄露到 Git 仓库中**。
3.  **系统级控制：** **PATH** 变量让你安装像 Go 语言这样的工具时，能够直接在任何目录下使用命令，而不需要输入冗长的全路径。

“**环境变量是程序与环境的桥梁。** 理解了它，你就掌握了配置系统、保证安全部署的核心方法。